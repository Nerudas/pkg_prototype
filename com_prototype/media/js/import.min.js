(function(a){a(document).ready(function(){var f=a("#importForm"),d=a(f).find(".control-group.stages"),e=a(f).find(".control-group.file"),c=a(f).find(".control-group.run"),b=a(f).attr("action");a(d).hide();a(d).find(".error").hide();a(d).find(".success").hide();a(c).show();a(e).show();a(f).on("submit",function(){a(d).find(".error").hide();a(d).find(".success").hide();a(d).find(".status").hide();a(d).show();a(c).hide();a(e).hide();i();return false});function i(){var n=a(d).find('[data-stage="1"]'),l=a(n).find(".status"),m=a(n).find(".error"),p=a(n).find(".success"),k=a(l).find(".current"),o=a(l).find(".total");a(k).text("0");a(o).text("1");a(m).hide();a(p).hide();a(l).show();var j=new FormData();j.append("task","import.prepareFile");j.append("files[]",a(f).find("input[type=file]").prop("files")[0]);a.ajax({type:"POST",dataType:"json",url:b,processData:false,contentType:false,cache:false,global:false,async:false,data:j,success:function(q){if(q.success){a(k).text(1);a(p).show();a(l).hide();h(q.data)}else{console.error(q.message);a(m).show();a(l).hide();a(c).show();a(e).show()}},error:function(q){console.error(q.status+": "+q.statusText);a(m).show();a(l).hide();a(c).show();a(e).show()}})}function h(n){var m=a(d).find('[data-stage="2"]'),k=a(m).find(".status"),l=a(m).find(".error"),p=a(m).find(".success"),j=a(k).find(".current"),o=a(k).find(".total");if(n.offset<n.total){a(j).text(n.offset);a(o).text(n.total);a(l).hide();a(p).hide();a(k).show();a.ajax({type:"POST",dataType:"json",url:b,cache:false,global:false,async:false,data:{task:"import.importItems",folder:n.folder,offset:n.offset,limit:n.limit,total:n.total},success:function(q){if(q.success){var r=q.data;a(j).text(r.offset);h(q.data)}else{console.error(q.message);a(l).show();a(k).hide();a(c).show();a(e).show()}},error:function(q){console.error(q.status+": "+q.statusText);a(l).show();a(k).hide();a(c).show();a(e).show()}})}else{a(p).show();a(k).hide();g(n)}}function g(n){var m=a(d).find('[data-stage="3"]'),k=a(m).find(".status"),l=a(m).find(".error"),p=a(m).find(".success"),j=a(k).find(".current"),o=a(k).find(".total");a.ajax({type:"POST",dataType:"json",url:b,cache:false,global:false,async:false,data:{task:"import.clear",folder:n.folder},success:function(q){if(q.success){var r=q.data;a(j).text("1");a(p).show();a(k).hide();a(c).show();a(e).show()}else{console.error(q.message);a(l).show();a(k).hide();a(c).show();a(e).show()}},error:function(q){console.error(q.status+": "+q.statusText);a(l).show();a(k).hide();a(c).show();a(e).show()}})}})})(jQuery);