(function(c){c(document).ready(function(){var e=[];function d(){c("[data-input-preset-palcemark]").each(function(){var g=c(this).data("filename");if(g==""){g=f(c(this).data("filename"))}c(this).data("filename",g);c(this).attr("data-filename",g);e.push(g);let field=c(this),form=field.find(".form"),input=form.find('input[type="file"]'),image=form.find("img"),value=form.find(".value");let folder_field=c("#jform_images_folder"),folder=c(folder_field).val()+"/presets";if(folder_field.length===0||folder===""){c(field).remove()}else{h()}input.on("change",function(l){if(!form.hasClass("disable")){k(l.target.files)}});function k(l){let ajaxData=new FormData();ajaxData.append("type","image");ajaxData.append("folder",folder);ajaxData.append("filename",c(field).data("filename"));ajaxData.append("noimage","0");ajaxData.append("files[]",l[0]);c.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=uploadFile",processData:false,contentType:false,cache:false,global:false,async:false,data:ajaxData,beforeSend:function(){c(form).addClass("disable")},complete:function(){c(form).removeClass("disable")},success:function(m){if(m.success){if(m.data!=="0"){c(image).attr("src","/"+m.data);c(value).val(m.data)}else{c(image).attr("src","");c(value).val("")}}else{console.error(m.message)}},error:function(m){console.error(m.status+": "+m.statusText)}})}function h(){c.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=getFile",cache:false,global:false,async:false,data:{type:"image",folder:folder,filename:c(field).data("filename"),noimage:0},beforeSend:function(){c(form).addClass("disable")},complete:function(){c(form).removeClass("disable")},success:function(l){if(l.success){if(l.data!=0){c(image).attr("src","/"+l.data);c(value).val(l.data)}else{c(image).attr("src","");c(value).val("")}}else{c(image).attr("src","");c(value).val("")}},error:function(l){console.error(l.status+": "+l.statusText)}})}c(form).find("a.remove").on("click",function(){c.ajax({type:"POST",dataType:"json",url:"index.php?option=com_ajax&plugin=files&group=fieldtypes&format=json&task=deleteFile",cache:false,global:false,async:false,data:{type:"image",folder:folder,filename:c(field).data("filename"),noimage:"0"},beforeSend:function(){c(form).addClass("disable")},complete:function(){c(form).removeClass("disable")},success:function(l){if(l.success){if(l.data!=="0"){c(image).attr("src","/"+l.data);c(value).val(l.data)}else{c(image).attr("src","");c(value).val("")}}else{c(image).attr("src","");c(value).val("")}},error:function(l){console.error(l.status+": "+l.statusText)}})})})}function f(g){if(g==""||jQuery.inArray(g,e)>=0){let a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),b=[];for(let i=0;i<7;i++){let j=(Math.random()*(a.length-1)).toFixed(0);b[i]=a[j]}g=b.join("");f(g)}return g}d();c(document).on("subform-row-add",function(g,h){if(c(h).data("base-name")=="presets"){d()}});c(document).on("subform-row-remove",function(g,h){c(h).find("[data-input-preset-palcemark]").find("a.remove").trigger("click")})})})(jQuery);